import requests
import hashlib
import json

def test_supply_chain_vulnerabilities(base_url, api_key):
    # Verificar el certificado SSL del sitio
    try:
        requests.get(base_url, verify=True)
    except requests.exceptions.SSLError:
        print("SSL Certificate could not be verified.")

    # Calcular el hash del contenido de la respuesta para verificar su integridad
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    }
    payload = json.dumps({
        "prompt": "Hello, world!",
        "max_tokens": 5
    })
    
    response = requests.post(
        f"{base_url}/generate", 
        headers=headers, 
        data=payload
    )
    
    content_hash = hashlib.sha256(response.content).hexdigest()
    print(f"SHA-256 Hash of the response content: {content_hash}")

    # Aquí podrías comparar este hash con un valor esperado para asegurarte de que la respuesta no ha sido manipulada
    
# Ejemplo de uso
# base_url = "https://api.openai.com/v1/engines/davinci-codex"
# api_key = "your_openai_api_key_here"
# test_supply_chain_vulnerabilities(base_url, api_key)
