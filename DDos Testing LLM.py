import requests
import json
import threading
import time

def send_request(base_url, api_key):
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    }
    payload = json.dumps({
        "prompt": "Translate the following English text to French: '{}'",
        "max_tokens": 50
    })
    try:
        response = requests.post(
            f"{base_url}/generate", 
            headers=headers, 
            data=payload
        )
        if response.status_code != 200:
            print(f"Received non-200 status code: {response.status_code}")
    except Exception as e:
        print(f"An error occurred: {e}")

def test_model_dos(base_url, api_key, num_threads=10):
    threads = []
    for i in range(num_threads):
        thread = threading.Thread(target=send_request, args=(base_url, api_key))
        threads.append(thread)
        thread.start()
        
    for thread in threads:
        thread.join()

# Ejemplo de uso
# base_url = "https://api.openai.com/v1/engines/davinci-codex"
# api_key = "your_openai_api_key_here"
# test_model_dos(base_url, api_key)
